@using CentralizedSalesSystem.Frontend.Models

<MudPaper Elevation="2" Class="pa-3">
    <MudText Typo="Typo.h6" Class="mb-2">@Title</MudText>
    <MudTable Items="Reservations" Hover="true" Dense="true" Elevation="0">
        <HeaderContent>
            <MudTh>ID</MudTh>
            <MudTh>Client</MudTh>
            <MudTh>Phone</MudTh>
            <MudTh>Staff</MudTh>
            <MudTh>Date</MudTh>
            <MudTh>Status</MudTh>
            <MudTh Style="width: 200px;">Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.Id</MudTd>
            <MudTd>@context.CustomerName</MudTd>
            <MudTd>@context.CustomerPhone</MudTd>
            <MudTd>@(StaffLookup.TryGetValue(context.AssignedEmployee ?? -1, out var staff) ? staff : "Unassigned")</MudTd>
            <MudTd>@context.AppointmentTime.ToLocalTime().ToString("g")</MudTd>
            <MudTd>
                <MudChip T="ReservationStatus" Color="@GetStatusColor(context.Status)" Size="Size.Small" Variant="Variant.Outlined">
                    @context.Status
                </MudChip>
            </MudTd>
            <MudTd>
                @if (OnEdit.HasDelegate)
                {
                    <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small" OnClick="@(() => OnEdit.InvokeAsync(context))" Class="mr-2">
                        Edit
                    </MudButton>
                }
                @if (ShowDelete && OnDelete.HasDelegate)
                {
                    <MudButton Variant="Variant.Outlined" Color="Color.Error" Size="Size.Small" OnClick="@(() => OnDelete.InvokeAsync(context))" Class="mr-2">
                        Remove
                    </MudButton>
                }
                @if (OnStatusChange.HasDelegate && context.Status == ReservationStatus.Scheduled)
                {
                    <MudButton Variant="Variant.Outlined" Color="Color.Success" Size="Size.Small" OnClick="@(() => OnStatusChange.InvokeAsync(context))">
                        Complete
                    </MudButton>
                }
            </MudTd>
        </RowTemplate>
    </MudTable>
</MudPaper>

@code {
    [Parameter] public string Title { get; set; } = string.Empty;
    [Parameter] public IEnumerable<ReservationDto> Reservations { get; set; } = Enumerable.Empty<ReservationDto>();
    [Parameter] public Dictionary<long, string> StaffLookup { get; set; } = new();
    [Parameter] public EventCallback<ReservationDto> OnStatusChange { get; set; }
    [Parameter] public EventCallback<ReservationDto> OnEdit { get; set; }
    [Parameter] public EventCallback<ReservationDto> OnDelete { get; set; }
    [Parameter] public bool ShowDelete { get; set; } = true;

    private Color GetStatusColor(ReservationStatus status) =>
        status switch
        {
            ReservationStatus.Scheduled => Color.Warning,
            ReservationStatus.Completed => Color.Success,
            ReservationStatus.Cancelled => Color.Error,
            _ => Color.Default
        };
}
