@using CentralizedSalesSystem.Frontend.Models
@namespace CentralizedSalesSystem.Frontend.Pages.Employee.Restaurant.Components

<MudPaper Elevation="2" Class="pa-4">
    <div class="d-flex align-center justify-space-between mb-4">
        <MudText Typo="Typo.h5">Floor: Dining room</MudText>
        <MudSelect T="TableStatus?" @bind-Value="Filter" Label="Filter" Dense="true" Class="table-filter">
            <MudSelectItem T="TableStatus?" Value="@((TableStatus?)null)">All</MudSelectItem>
            <MudSelectItem T="TableStatus?" Value="TableStatus.Occupied">Occupied</MudSelectItem>
            <MudSelectItem T="TableStatus?" Value="TableStatus.Reserved">Reserved</MudSelectItem>
            <MudSelectItem T="TableStatus?" Value="TableStatus.Free">Free</MudSelectItem>
        </MudSelect>
    </div>

    <MudGrid GutterSize="3">
        @foreach (var table in Tables)
        {
            <MudItem xs="6" sm="4" md="3">
                <MudPaper Elevation="1"
                          Class="@GetTableCardClass(table)"
                          @onclick="() => OnSelect.InvokeAsync(table)">
                    <MudStack Spacing="1">
                        <MudText Typo="Typo.subtitle1">@table.Name</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Seats @table.Capacity</MudText>
                        <MudChip T="TableStatus" Color="@GetTableColor(table.Status)" Variant="Variant.Filled" Size="Size.Small">
                            @table.Status
                        </MudChip>
                        <MudButton Variant="Variant.Text"
                                   Color="Color.Secondary"
                                   Disabled="@(table.Status == TableStatus.Occupied)"
                                   OnClick="@(() => OnToggleReservation.InvokeAsync(table))">
                            @(table.Status == TableStatus.Reserved ? "Unreserve" : "Reserve")
                        </MudButton>
                    </MudStack>
                </MudPaper>
            </MudItem>
        }
    </MudGrid>
</MudPaper>

@code {
    [Parameter] public IEnumerable<TableDto> Tables { get; set; } = Enumerable.Empty<TableDto>();
    [Parameter] public TableStatus? Filter { get; set; }
    [Parameter] public EventCallback<TableStatus?> FilterChanged { get; set; }
    [Parameter] public EventCallback<TableDto> OnSelect { get; set; }
    [Parameter] public EventCallback<TableDto> OnToggleReservation { get; set; }
    [Parameter] public long? SelectedTableId { get; set; }

    private string GetTableCardClass(TableDto table)
    {
        var status = table.Status.ToString().ToLowerInvariant();
        var isSelected = table.Id == SelectedTableId;
        return $"table-card {status}" + (isSelected ? " selected" : string.Empty);
    }

    private static Color GetTableColor(TableStatus status) => status switch
    {
        TableStatus.Occupied => Color.Success,
        TableStatus.Reserved => Color.Warning,
        _ => Color.Default
    };
}
